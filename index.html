<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>UnGram</title>

<style>
/* ==========================
   THEME VARIABLES
========================== */
:root {
    --bg: #111; --text: #eee; --box-border: #777; --box-hover: #222;
    --row-bg: #1a1a1a; --link: #66aaff; --remove: #c62828; --remove-hover: #b71c1c;
    --btn-bg: black; --btn-hover: #222; --textarea-bg: #000; --textarea-text: #0f0;
    --heading-text: #66aaff;   
    --result-text: #0f0;      
}
.light {
    --bg: #f7f7f7; --text: #111; --box-border: #999; --box-hover: #ddd;
    --row-bg: #fff; --link: #0066cc; --remove: #d9534f; --remove-hover: #c9302c;
    --btn-bg: #fff; --btn-hover: #eee; --textarea-bg: #fafafa; --textarea-text: #333;
    --heading-text: #0066cc;
    --result-text: #333;
}
.barbie {
    --bg: #ffe4f7; --text: #a0006b; --box-border: #ff7bd8; --box-hover: #ffd0f2;
    --row-bg: #fff0fb; --link: #ff00aa; --remove: #ff3c8c; --remove-hover: #e6006e;
    --btn-bg: #ffb3e6; --btn-hover: #ff99df; --textarea-bg: #ffe0f5; --textarea-text: #c20087;
    background-image: repeating-linear-gradient(45deg, #ffd6f2 0 10px, #ffe9f9 10px 20px);
    --heading-text: #ff00aa;
    --result-text: #c20087;
}

/* ==========================
   GENERAL STYLES
========================== */
body {
    font-family: Arial;
    max-width: 600px;
    margin: 30px auto;
    padding: 20px;
    background: var(--bg);
    color: var(--text);
    transition: 0.3s;
}

h2 { font-family: 'Arial', sans-serif; font-weight: bold; font-style: italic; font-size: 32px; letter-spacing: 1px; text-align: center; color: var(--heading-text); margin-bottom: 20px; }
h3 { font-family: 'Brush Script MT', cursive, 'Segoe Script', sans-serif; font-size: 22px; text-align:center; color: var(--heading-text);  margin-bottom: 20px; }

/* THEME & INFO BUTTONS */
#themeToggle, #zipUploadBtn {
    position: fixed; top: 15px; padding: 8px 14px; border-radius: 8px; background: var(--btn-bg); color: var(--text); border: 1px solid #666; cursor:pointer; z-index:999; transition:0.3s;
}
#themeToggle { right:15px; }
#zipUploadBtn { left:15px; }
#themeToggle:hover, #zipUploadBtn:hover { background: var(--btn-hover); }

#infoIcon {
    position: fixed; top:28px; right:100px; width:28px; height:28px; background: var(--row-bg); color: var(--text); border-radius:50%; display:flex; justify-content:center; align-items:center; font-weight:bold; cursor:pointer; box-shadow:0 0 5px rgba(0,0,0,0.5); z-index:1000; transition:0.2s;
}
#infoIcon:hover { background: var(--box-hover); }

#copyResultsBtn {
    display:block;
    margin: 10px auto;
    padding: 8px 14px;
    background: var(--btn-bg);
    color: var(--text);
    border:1px solid #444;
    border-radius:6px;
    cursor:pointer;
}
#copyResultsBtn:hover { background: var(--btn-hover); }

/* Modal styling enhancements */
.modal {
    display: none;
    position: fixed;
    z-index: 999;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.7);
    justify-content: center;
    align-items: center;
    overflow: hidden; 
}

.modal-content {
    background: var(--row-bg);
    padding: 25px 20px;
    border-radius: 12px;
    max-width: 450px;
    color: var(--text);
    box-shadow: 0 8px 25px rgba(0,0,0,0.35);
    font-size: 15px;
    line-height: 1.5;
}

/* Step card */
.modal-step {
    margin: 10px 0;
    padding: 10px 12px;
    border-radius: 8px;
    background: rgba(255,255,255,0.05);
}

/* Highlighted keywords */
.highlight { color: var(--link); font-weight: bold; }

/* Modal buttons */
.modal-content button {
    margin: 6px 5px;
    padding: 6px 12px;
    border-radius: 6px;
    border: none;
    background: var(--btn-bg);
    color: var(--text);
    cursor: pointer;
    font-weight: bold;
    transition: 0.2s;
}
.modal-content button:hover { background: var(--btn-hover); }

/* Step counter */
.step-counter {
    text-align: center;
    font-size: 13px;
    opacity: 0.7;
    margin-bottom: 8px;
}

/* BOXES */
.box { border:2px dashed var(--box-border); padding:15px; margin:10px 0; text-align:center; border-radius:8px; cursor:pointer; }
.box:hover { background: var(--box-hover); }

#result { color: var(--result-text); }

/* RESULTS */
.user-row { display:flex; justify-content:space-between; align-items:center; background: var(--row-bg); padding:6px 10px; margin:4px 0; border-radius:5px; }
.user-row a { color: var(--link); text-decoration:none; }
.user-row a:hover { text-decoration:underline; }
.remove-btn { background: var(--remove); color:white; border:none; padding:4px 10px; font-size:12px; border-radius:4px; cursor:pointer; }
.remove-btn:hover { background: var(--remove-hover); }

#undoBtn { background: #444; margin-top: 10px; }
#undoBtn:hover { background: #555; }

textarea { width:100%; height:150px; margin-top:10px; background: var(--textarea-bg); color: var(--textarea-text); padding:10px; border-radius:6px; }

button { padding:10px 14px; margin:8px 4px; background: var(--btn-bg); color: var(--text); border:1px solid #444; border-radius:6px; cursor:pointer; }
button:hover { background: var(--btn-hover); }

/* ==========================
   MEDIA QUERIES
========================== */
@media screen and (max-width:768px){
    body{margin:10px;padding:10px;}
    h2,h3{font-size:18px;}
    .box{padding:12px;font-size:14px;}
    #undoBtn,button,#themeToggle,#zipUploadBtn,#infoIcon{width:100%; margin-top:6px; font-size:14px; position:relative; top:auto; left:auto; right:auto;}
    .user-row{flex-direction:column;align-items:flex-start;padding:8px;}
    .user-row a{margin-bottom:6px;}
    textarea{height:120px;font-size:14px;}
}
</style>
</head>
<body>

<button id="themeToggle" onclick="switchTheme()">Theme</button>
<button id="zipUploadBtn">Zip Extractor</button>
<div id="infoIcon" onclick="showInfo()">?</div>

<h2>Who Unfollowed you?</h2>

<b>Followers File</b>
<div class="box" id="followersBox">Click or Drop Followers File</div>
<input type="file" id="followersFile" hidden>

<b>Following File</b>
<div class="box" id="followingBox">Click or Drop Following File</div>
<input type="file" id="followingFile" hidden>

<button onclick="compare()">Get Results</button>

<div id="resultsContainer" style="display:none; margin-top:20px;">
    <h3 id="resultsHeading">
        Results
        <button id="copyResultsBtn" onclick="copyResults()" style="margin-left:10px; font-size:14px;">üìã Copy Results</button>
        <button id="undoBtn" onclick="undoRemove()" style="margin-left:10px;">Undo Remove</button>
    </h3>
    <div id="result"></div>
    <textarea id="output" readonly style="width:100%; height:150px; margin-top:10px;"></textarea>
</div>

<!-- INFO MODAL -->
<div id="infoModal" class="modal">
  <div class="modal-content" id="infoPanel">
    <!-- Dynamic content injected by JS -->
  </div>
</div>

<input type="file" id="zipFileInput" hidden>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<script>
/* THEME */
const themes=["dark","light","barbie"]; let themeIndex=0;
function loadTheme(){ const saved=localStorage.getItem("theme"); if(saved && themes.includes(saved)){document.body.className=saved; themeIndex=themes.indexOf(saved);} }
loadTheme();
function switchTheme(){ themeIndex=(themeIndex+1)%themes.length; const t=themes[themeIndex]; document.body.className=t; localStorage.setItem("theme",t); }

/* ======================
   INFO MODAL & INTRO TUTORIAL
====================== */
const infoModal = document.getElementById("infoModal");
const infoPanel = document.getElementById("infoPanel");
let currentPart = 0;

const introParts = [
    { 
        title: "Welcome to UnGram üëã",
        content: `
        <div class="modal-step">
            <p>This tool helps you find Instagram users who don't follow you back.</p>
            <p>We‚Äôll guide you step by step through the process.</p>
        </div>
        `
    },
    { 
        title: "Two Ways to Upload Your Data",
        content: `
        <div class="modal-step">
            <p>üíæ If you have already exported your <span class="highlight">followers</span> and <span class="highlight">following</span> files individually, you can upload them directly to the boxes on the main page.</p>
        </div>
        <div class="modal-step">
            <p>üìÇ Otherwise, you can use the <span class="highlight">ZIP Extractor</span> button to upload the exported ZIP file. This will automatically extract the needed files for you.</p>
        </div>
        `
    },
    { 
        title: "How to Export a ZIP from Instagram",
        content: `
        <div class="modal-step">
            <p>‚öôÔ∏è Open <b>Settings ‚Üí Accounts Center ‚Üí Your information & permissions</b></p>
        </div>
        <div class="modal-step">
            <p>‚¨áÔ∏è Select <b>Download your information ‚Üí Create export ‚Üí Export to device</b></p>
        </div>
        <div class="modal-step">
            <p>üìù Turn ON only <b>Followers</b> & <b>Following</b>, date range: <b>All time</b></p>
        </div>
        <div class="modal-step">
            <p>‚è≥ Wait for the download (device or email). You will get a <b>ZIP file</b> containing the files.</p>
        </div>
        <div class="modal-step">
            <p>üìÇ Open the ZIP ‚Üí look for <b>followers_1</b> and <b>following</b> files (HTML or JSON) ‚Üí upload using the boxes or ZIP extractor.</p>
        </div>
        `
    },
    { 
        title: "Buttons Overview",
        content: `
        <div class="modal-step">
            <ul>
                <li><b>Get Results:</b> Compare your followers & following files.</li>
                <li><b>Copy Results:</b> Copy all unfollowers to your clipboard.</li>
                <li><b>Undo Remove:</b> Restore the last user you manually removed. (Useful if some accounts are deactivated)</li>
                <li><b>Theme:</b> Switch between Dark, Light, and Fun ‚ÄúBarbie‚Äù theme.</li>
                <li><b>Upload ZIP:</b> Upload a ZIP containing both followers and following files automatically.</li>
            </ul>
        </div>
        `
    }
];

function updateModalPart() {
    const part = introParts[currentPart];
    infoPanel.innerHTML = `
        <div class="step-counter">Step ${currentPart+1} of ${introParts.length}</div>
        <h3>${part.title}</h3>
        ${part.content}
        <div style="margin-top:15px;">
            ${currentPart>0?'<button onclick="prevPart()">‚¨ÖÔ∏è Previous</button>':''}
            ${currentPart<introParts.length-1?'<button onclick="nextPart()">Next ‚û°Ô∏è</button>':'<button onclick="finishIntro()">Got it!</button>'}
        </div>
    `;
}


function showInfo() {
    currentPart = 0;        
    updateModalPart();      
    infoModal.style.display = "flex";  
}

// Hide the info modal
function hideInfo() {
    infoModal.style.display = "none";
}


function nextPart(){ if(currentPart<introParts.length-1){currentPart++; updateModalPart();} }
function prevPart(){ if(currentPart>0){currentPart--; updateModalPart();} }
function finishIntro(){ hideInfo(); }

/* DRAG & DROP FILES */
function setup(boxId,inputId){
  const box=document.getElementById(boxId), input=document.getElementById(inputId);
  box.onclick=()=>input.click();
  box.ondragover=e=>{e.preventDefault();box.style.background="var(--box-hover)";}
  box.ondragleave=()=>box.style.background="";
  box.ondrop=e=>{e.preventDefault();box.style.background="";input.files=e.dataTransfer.files; box.textContent=input.files[0].name;}
  input.onchange=()=>{if(input.files.length)box.textContent=input.files[0].name;}
}
setup("followersBox","followersFile");
setup("followingBox","followingFile");

/* COMPARE & PARSING */
let globalFollowers=[], globalFollowing=[], globalList=[], lastRemoved=null;

async function compare() {
    const folFile=document.getElementById("followersFile").files[0];
    const ingFile=document.getElementById("followingFile").files[0];
    if(!folFile||!ingFile){alert("Upload both files");return;}
    document.getElementById("result").innerHTML="<p>Loading‚Ä¶</p>";
    globalFollowers=await extract(folFile);
    globalFollowing=await extract(ingFile);
    globalList=globalFollowing.filter(u=>!globalFollowers.includes(u));
    document.getElementById("resultsContainer").style.display="block";
    renderList();
}

async function extract(file){ const text=await file.text(); if(file.name.endsWith(".json")) return parseJSON(text); if(file.name.endsWith(".html")) return parseHTML(text); return []; }
function clean(u){ if(!u)return null; u=u.trim().replace(/^\/+/,"").replace(/^_u\//,"").replace(/^\/_u\//,"").replace(/\/$/,""); return /^[a-zA-Z0-9._]+$/.test(u)?u:null; }
function parseJSON(text){ try{ let data=JSON.parse(text), out=[]; if(Array.isArray(data)) data.forEach(e=>{ const u=clean(e?.string_list_data?.[0]?.value); if(u) out.push(u); }); if(data.relationships_following) data.relationships_following.forEach(e=>{ let u=e.title?clean(e.title):e.string_list_data?.[0]?.href?.split("/").pop(); u=clean(u); if(u) out.push(u); }); if(data.relationships_followers) data.relationships_followers.forEach(e=>{ const u=clean(e.string_list_data?.[0]?.value); if(u) out.push(u); }); return [...new Set(out)]; }catch{return [];} }
function parseHTML(html){ const doc=new DOMParser().parseFromString(html,"text/html"); const out=new Set(); [...doc.querySelectorAll("h2")].forEach(h=>{ const u=clean(h.textContent); if(u) out.add(u); }); [...doc.querySelectorAll("a")].forEach(a=>{ try{ const url=new URL(a.href,"https://instagram.com"); if(!url.hostname.includes("instagram.com")) return; const path=url.pathname.replace(/^\/+|\/+$/g,""); if(path&&/^[a-zA-Z0-9._]+$/.test(path)) out.add(path);}catch{} }); return Array.from(out); }

/* RENDER LIST */
function renderList() {
    const div=document.getElementById("result");
    div.innerHTML=`<p><b>Not Following Back:</b> ${globalList.length}</p><hr>`;
    globalList.forEach(u=>{
        const row=document.createElement("div");
        row.className="user-row";
        row.innerHTML=`<a href="https://instagram.com/${u}" target="_blank">${u}</a><button class="remove-btn" onclick="removeUser('${u}')">Remove</button>`;
        div.appendChild(row);
    });
    updateTextarea();
    document.getElementById("copyResultsBtn").style.display=globalList.length?"inline-block":"none";
    document.getElementById("undoBtn").style.display=globalList.length?"inline-block":"none";
}

const undoBtn=document.getElementById("undoBtn");
undoBtn.style.display="none"; undoBtn.disabled=true;
function removeUser(u){ lastRemoved=u; globalList=globalList.filter(x=>x!==u); renderList(); undoBtn.style.display="inline-block"; undoBtn.disabled=false; }
function undoRemove(){ if(!lastRemoved)return; globalList.push(lastRemoved); lastRemoved=null; globalList.sort(); renderList(); undoBtn.style.display="none"; undoBtn.disabled=true; }
function updateTextarea(){ let txt=`Not Following Back: ${globalList.length}\n\n`; globalList.forEach(u=>{ txt+=`${u} - https://instagram.com/${u}\n`; }); document.getElementById("output").value=txt; }
function copyResults(){ navigator.clipboard.writeText(document.getElementById("output").value); alert("Copied!"); }

/* ZIP UPLOADER */
const zipUploadBtn=document.getElementById('zipUploadBtn');
const zipInput=document.getElementById('zipFileInput');
zipUploadBtn.onclick=()=>zipInput.click();
zipInput.ondragover=e=>{ e.preventDefault(); zipUploadBtn.style.background="#444"; }
zipInput.ondragleave=()=>zipUploadBtn.style.background="";
zipInput.ondrop=e=>{ e.preventDefault(); zipUploadBtn.style.background=""; handleZip(e.dataTransfer.files[0]); }
zipInput.onchange=()=>{ if(zipInput.files.length) handleZip(zipInput.files[0]); }

async function handleZip(file){
    if(!file.name.endsWith('.zip')){alert('Not a ZIP file');return;}
    const jszip=new JSZip();
    const zip=await jszip.loadAsync(file);
    let followersFile=null;
    let followingFile=null;
    for(const f of Object.values(zip.files)){
        if(f.dir) continue;
        const fname=f.name.split('/').pop().toLowerCase();
        const text=(await f.async('text')).trim();
        if(!followersFile && fname.includes('followers') && (fname.startsWith('followers') || fname.includes('_followers'))){
            followersFile=new File([text], f.name.split('/').pop(), {type:"text/html"});
        }
        if(!followingFile && fname.includes('following') && (fname.startsWith('following') || fname.includes('_following'))){
            followingFile=new File([text], f.name.split('/').pop(), {type:"text/html"});
        }
    }
    if(!followersFile || !followingFile){ alert('Could not find both followers and following files in ZIP.'); return; }
    const dtF=new DataTransfer(); dtF.items.add(followersFile);
    const dtG=new DataTransfer(); dtG.items.add(followingFile);
    document.getElementById("followersFile").files=dtF.files;
    document.getElementById("followingFile").files=dtG.files;
    document.getElementById("followersBox").textContent=followersFile.name;
    document.getElementById("followingBox").textContent=followingFile.name;
}
</script>

</body>
</html>
