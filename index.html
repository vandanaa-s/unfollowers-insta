<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<title>UnGram</title>

<style>
/* ==========================
   GENERAL STYLES
========================== */
body {
    font-family: Arial, sans-serif;
    max-width: 100%;       
    margin: 10px;         
    padding: 20px;
    background: var(--bg);
    color: var(--text);
    transition: 0.3s;
}


@media screen and (min-width: 769px) {
    body {
        max-width: 600px;
        margin: 30px auto;
    }
}

/* THEME VARIABLES */
:root {
    --bg: #111; --text: #eee; --box-border: #777; --box-hover: #222;
    --row-bg: #1a1a1a; --link: #66aaff; --remove: #c62828; --remove-hover: #b71c1c;
    --btn-bg: black; --btn-hover: #222; --textarea-bg: #000; --textarea-text: #0f0;
}

/* Light mode */
.light {
    --bg: #f7f7f7; --text: #111; --box-border: #999; --box-hover: #ddd;
    --row-bg: #fff; --link: #0066cc; --remove: #d9534f; --remove-hover: #c9302c;
    --btn-bg: #fff; --btn-hover: #eee; --textarea-bg: #fafafa; --textarea-text: #333;
}

/* Barbie glitter mode */
.barbie {
    --bg: #ffe4f7; --text: #a0006b; --box-border: #ff7bd8; --box-hover: #ffd0f2;
    --row-bg: #fff0fb; --link: #ff00aa; --remove: #ff3c8c; --remove-hover: #e6006e;
    --btn-bg: #ffb3e6; --btn-hover: #ff99df; --textarea-bg: #ffe0f5; --textarea-text: #c20087;
    background-image: repeating-linear-gradient(45deg, #ffd6f2 0 10px, #ffe9f9 10px 20px);
}

/* BUTTONS AND BOXES */
button, .box {
    cursor: pointer;
    border-radius: 6px;
    transition: 0.3s;
}

/* Drag/Drop boxes */
.box {
    border: 2px dashed var(--box-border);
    padding: 15px;
    margin: 10px 0;
    text-align: center;
}
.box:hover { background: var(--box-hover); }

/* Username rows */
.user-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--row-bg);
    padding: 6px 10px;
    margin: 4px 0;
    border-radius: 5px;
}
.user-row a { color: var(--link); text-decoration: none; }
.user-row a:hover { text-decoration: underline; }

/* Remove buttons */
.remove-btn {
    background: var(--remove);
    color: white;
    border: none;
    padding: 4px 10px;
    font-size: 12px;
    border-radius: 4px;
    cursor: pointer;
}
.remove-btn:hover { background: var(--remove-hover); }

/* Textarea */
textarea {
    width: 100%;
    height: 150px;
    margin-top: 10px;
    background: var(--textarea-bg);
    color: var(--textarea-text);
    padding: 10px;
    border-radius: 6px;
}

/* MODAL */
.modal {
    display: none;
    position: fixed;
    z-index: 999;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.7);
    justify-content: center;
    align-items: center;
}
.modal-content {
    background: var(--row-bg);
    padding: 20px;
    border-radius: 10px;
    max-width: 400px;
    color: var(--text);
}

/* Info panel inside modal */
#infoPanel h3 { margin-top:0; text-align:center; }
#infoPanel ol { padding-left: 20px; }
#infoPanel li { margin: 10px 0; padding: 8px; border-radius: 8px; background: var(--box-hover); }

/* Theme toggle & icons */
#themeToggle, #zipBtn, #infoIcon {
    padding: 8px 14px;
    font-size: 14px;
    border-radius: 8px;
}

/* MOBILE RESPONSIVE */
@media screen and (max-width: 768px) {
    h2, h3 { font-size: 18px; }
    .box { font-size: 14px; padding: 12px; }
    button, #undoBtn { width: 100%; font-size: 14px; padding: 10px 0; margin-top: 6px; }
    .user-row { flex-direction: column; align-items: flex-start; padding: 8px; }
    .user-row a { margin-bottom: 6px; }
    textarea { height: 120px; font-size: 14px; }
    #themeToggle, #zipBtn, #infoIcon { padding: 6px 10px; font-size: 12px; position: relative; margin: 5px 2px; top:auto; right:auto; left:auto; }
}
</style>
</head>
<body>

<button id="themeToggle" onclick="switchTheme()">Theme</button>
<div id="infoIcon" onclick="showInfo()">?</div>
<button id="zipBtn" onclick="location.href='zip.html'" style="position: fixed; top: 15px; left: 15px; z-index:999; padding:8px 14px; border-radius:8px; background:var(--btn-bg); color:var(--text); border:1px solid #666;">Zip Check</button>


<h2>Sleezy Unfollowers Check</h2>

<b>Followers File</b>
<div class="box" id="followersBox">Click or Drop Followers File</div>
<input type="file" id="followersFile" hidden>

<b>Following File</b>
<div class="box" id="followingBox">Click or Drop Following File</div>
<input type="file" id="followingFile" hidden>

<button onclick="compare()">Compare</button>
<button onclick="copyResults()">Copy</button>
<button id="undoBtn" onclick="undoRemove()" disabled>Undo Remove</button>

<h3>Results</h3>
<div id="result"></div>

<textarea id="output"></textarea>

<!-- INFO MODAL -->
<div id="infoModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="hideInfo()">&times;</span>
        <div id="infoPanel">
            <h3>üì• How to Export Your Instagram Data</h3>
            <ol>
                <li>‚öôÔ∏è Open <b>Settings</b> ‚Üí <b>Accounts Center</b> ‚Üí <b>Your information and permissions</b></li>
                <li>‚¨áÔ∏è Select <b>Download your information</b> ‚Üí <b>Create export</b> ‚Üí <b>Export to device</b></li>
                <li>üìù Customize: Turn ON only <b>Followers</b> & <b>Following</b>, date range: <b>All time</b></li>
                <li>‚è≥ Wait for download (device or email)</li>
                <li>üìÇ Open folder ‚Üí find <b>followers_1</b> & <b>following</b> files (HTML or JSON)</li>
            </ol>
        </div>
    </div>
</div>

<script>
/* THEME SYSTEM */
const themes = ["dark","light","barbie"];
let themeIndex = 0;
function loadTheme() {
    const saved = localStorage.getItem("theme");
    if(saved && themes.includes(saved)) { document.body.className = saved; themeIndex = themes.indexOf(saved); }
}
loadTheme();
function switchTheme() {
    themeIndex = (themeIndex+1)%themes.length;
    const t = themes[themeIndex];
    document.body.className = t;
    localStorage.setItem("theme",t);
}

/* INFO MODAL */
function showInfo(){ document.getElementById("infoModal").style.display="flex"; }
function hideInfo(){ document.getElementById("infoModal").style.display="none"; }
window.onclick = e => { if(e.target === document.getElementById("infoModal")) hideInfo(); };

/* DRAG & DROP */
setup("followersBox","followersFile");
setup("followingBox","followingFile");
function setup(boxId,inputId){
    const box=document.getElementById(boxId), input=document.getElementById(inputId);
    box.onclick=()=>input.click();
    box.ondragover=e=>{ e.preventDefault(); box.style.background="var(--box-hover)"; };
    box.ondragleave=()=>box.style.background="";
    box.ondrop=e=>{ e.preventDefault(); box.style.background=""; input.files=e.dataTransfer.files; box.textContent=input.files[0].name; };
    input.onchange=()=>{ if(input.files.length) box.textContent=input.files[0].name; };
}

/* COMPARE & PARSING */
let globalFollowers=[], globalFollowing=[], globalList=[], lastRemoved=null;

async function compare(){
    const folFile=document.getElementById("followersFile").files[0];
    const ingFile=document.getElementById("followingFile").files[0];
    if(!folFile || !ingFile){ alert("Upload both files"); return; }
    document.getElementById("result").innerHTML="<p>Loading‚Ä¶</p>";
    globalFollowers = await extract(folFile);
    globalFollowing = await extract(ingFile);
    globalList = globalFollowing.filter(u=>!globalFollowers.includes(u));
    renderList();
}

async function extract(file){
    const text=await file.text();
    if(file.name.endsWith(".json")) return parseJSON(text);
    if(file.name.endsWith(".html")) return parseHTML(text);
    return [];
}

function clean(u){
    if(!u) return null;
    u=u.trim().replace(/^\/+/,"").replace(/^_u\//,"").replace(/^\/_u\//,"").replace(/\/$/,"");
    return /^[a-zA-Z0-9._]+$/.test(u)?u:null;
}

function parseJSON(text){
    try{
        let data=JSON.parse(text), out=[];
        if(Array.isArray(data)) data.forEach(e=>{ const u=clean(e?.string_list_data?.[0]?.value); if(u) out.push(u); });
        if(data.relationships_following) data.relationships_following.forEach(e=>{
            let u=e.title?clean(e.title):e.string_list_data?.[0]?.href?.split("/").pop();
            u=clean(u); if(u) out.push(u);
        });
        if(data.relationships_followers) data.relationships_followers.forEach(e=>{
            const u=clean(e.string_list_data?.[0]?.value); if(u) out.push(u);
        });
        return [...new Set(out)];
    }catch{ return []; }
}

function parseHTML(html){
    const doc=new DOMParser().parseFromString(html,"text/html");
    let out=[];
    [...doc.querySelectorAll("h2")].forEach(h=>{ const u=clean(h.textContent); if(u) out.push(u); });
    [...doc.querySelectorAll("a")].forEach(a=>{
        try{ const url=new URL(a.href); if(url.hostname.includes("instagram")){ let u=clean(url.pathname.replace(/^\/_u\//,"").replace(/\//g,"")); if(u) out.push(u); } }catch{}
    });
    return [...new Set(out)];
}

/* RENDER LIST */
function renderList(){
    const div=document.getElementById("result");
    div.innerHTML=`<p><b>Not Following Back:</b> ${globalList.length}</p><hr>`;
    globalList.forEach(u=>{
        const row=document.createElement("div");
        row.className="user-row";
        row.innerHTML=`<a href="https://instagram.com/${u}" target="_blank">${u}</a>
        <button class="remove-btn" onclick="removeUser('${u}')">Remove</button>`;
        div.appendChild(row);
    });
    updateTextarea();
}

/* REMOVE + UNDO */
function removeUser(u){ lastRemoved=u; globalList=globalList.filter(x=>x!==u); renderList(); document.getElementById("undoBtn").disabled=false; }
function undoRemove(){ if(!lastRemoved) return; globalList.push(lastRemoved); lastRemoved=null; globalList.sort(); renderList(); document.getElementById("undoBtn").disabled=true; }

/* TEXT EXPORT + COPY */
function updateTextarea(){
    let txt=`Not Following Back: ${globalList.length}\n\n`;
    globalList.forEach(u=>{ txt+=`${u} - https://instagram.com/${u}\n`; });
    document.getElementById("output").value=txt;
}

function copyResults(){
    navigator.clipboard.writeText(document.getElementById("output").value);
    alert("Copied!");
}

// Load ZIP files from localStorage and prefill boxes
window.addEventListener("load", () => {
    const zipFiles = JSON.parse(localStorage.getItem("zipFiles") || "[]");
    const display = document.getElementById("zipFilesDisplay");
    if(zipFiles.length){
        
        // Prepare a single DataTransfer to assign files
        const dtFollowers = new DataTransfer();
        const dtFollowing = new DataTransfer();

        zipFiles.forEach(f => {
            const blob = new Blob([f.content], {type: "text/plain"});
            const fileObj = new File([blob], f.name, {type: "text/plain"});
            
            if(f.type === 'followers') dtFollowers.items.add(fileObj);
            if(f.type === 'following') dtFollowing.items.add(fileObj);
        });

        if(dtFollowers.files.length > 0) {
            document.getElementById("followersFile").files = dtFollowers.files;
            document.getElementById("followersBox").textContent = dtFollowers.files[0].name;
        }
        if(dtFollowing.files.length > 0) {
            document.getElementById("followingFile").files = dtFollowing.files;
            document.getElementById("followingBox").textContent = dtFollowing.files[0].name;
        }
    }
});


</script>
</body>
</html>
